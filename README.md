# Excel 兩行字串差異分析工具 (Python / Pandas)

## 簡介

這個 Python 程式旨在幫助使用者比較 Excel 工作表中**兩欄字串數據**之間的差異。它會逐行比較指定的兩行文字內容，並精確找出所有不相同、多餘或缺少的**單一字元**，將這些不同的字元集中列出到新的欄位中。

本工具特別適用於：

  * 比對文件版本異動（例如：歌詞、程式碼片段、翻譯文本）。
  * 快速識別資料欄位中的細微差異（例如：名稱中的錯別字）。

## 🛠 技術要求

| 套件 | 用途 |
| :--- | :--- |
| `pandas` | 讀取、處理和寫入 Excel 檔案。 |
| `difflib` | Python 內建的序列比較函式庫，用於進行字串差異比對。 |
| `openpyxl` | Pandas 用於讀寫 `.xlsx` 檔案格式時的依賴項。 |

## 📦 安裝

在您的 Python 環境中，執行以下指令安裝所需套件：

```bash
pip install pandas openpyxl
```

## 🚀 如何使用

1.  **準備檔案：**
    將您的 Excel 檔案（`.xlsx` 或 `.xls` 格式）與 Python 腳本（`excel_compare.py`）放在同一個資料夾中。

2.  **執行程式：**
    開啟您的命令提示字元 (Command Prompt) 或終端機，執行：

    ```bash
    python excel_compare.py
    ```

3.  **輸入參數：**
    程式會引導您輸入以下資訊：

    | 參數 | 說明 | 範例輸入 |
    | :--- | :--- | :--- |
    | Excel 檔案路徑 | 您的檔案名稱（若檔案在相同目錄）。 | `data.xlsx` |
    | 工作表名稱 | 要進行比較的 Excel 工作表名稱。 | `Sheet1` 或 `原始數據` |
    | 第一行名稱 | Excel 中第一欄的標題名稱（**請輸入標題，而非 A、B 等欄位字母**）。 | `原文` |
    | 第二行名稱 | Excel 中第二欄的標題名稱。 | `修改版` |

    > **💡 提示：** 程式會自動去除您輸入的檔名和欄位名稱前後多餘的空格。

4.  **檢查結果：**
    程式執行完成後，會在相同資料夾生成一個名為 **`差異比對結果.xlsx`** 的新檔案。

    新檔案將新增一個名為 **`差異字元`** 的欄位，列出該行兩字串中所有不同的單個字元，並用逗號 ` ,  ` 分隔。

## ⚠️ 除錯與錯誤處理

如果程式回報 **`錯誤: 找不到您指定的欄位名稱。`**，請仔細檢查程式輸出。程式會自動列印出檔案中所有**有效的欄位標題**供您參考，請確保您輸入的名稱與列表中的標題完全匹配（包括大小寫）。

```
!! 錯誤: 找不到您指定的欄位名稱。
...
請參考以下所有有效的欄位標題，並重新執行程式：
-> '歌曲名稱'
-> '歌詞-原始'   <-- 請輸入此標題
-> '歌詞-修改'   <-- 請輸入此標題
```

## 核心程式邏輯 (`find_string_differences` 函式)

本工具的核心邏輯是使用 `difflib.SequenceMatcher` 比較兩個字串，並通過分析其操作碼（`replace`、`delete`、`insert`）來識別並擷取差異的字元：

1.  **`replace`**：兩字串中相對應位置不同的字元，兩邊的字元都會被收集。
2.  **`delete`**：只存在於第一個字串中的字元會被收集。
3.  **`insert`**：只存在於第二個字串中的字元會被收集。

最後，所有收集到的不同字元會透過 `set()` 進行**去重**，確保每個不同的字元只列出一次。
